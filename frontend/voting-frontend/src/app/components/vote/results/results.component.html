<div class="container mt-4">

  <h2 class="text-center mb-3">Voting results</h2>

  <!-- BOTON VOLVER SOLO PARA ADMIN -->
  <div class="mb-3" *ngIf="isAdmin">
    <button class="btn btn-secondary" (click)="goBack()">Back to admin panel</button>
  </div>

  <!-- TOP CANDIDATES -->
  <h4 class="mb-3">Top candidates</h4>
  <table *ngIf="pagedResults.length > 0" class="table table-bordered">
    <thead>
      <tr>
        <th>#</th>
        <th>Candidate</th>
        <th>Votes</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let r of pagedResults; let i = index">
        <td>{{ (currentCandidatesPage - 1) * candidatesPerPage + i + 1 }}</td>
        <td>{{ r.name }} {{ r.lastName }}</td>
        <td>{{ r.vote_count }}</td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="totalCandidatesPages > 1" class="mb-3">
    <button class="btn btn-sm btn-secondary" [disabled]="currentCandidatesPage === 1" 
            (click)="goToCandidatesPage(currentCandidatesPage - 1)">Previous</button>
    <span>Page {{currentCandidatesPage}} of {{totalCandidatesPages}}</span>
    <button class="btn btn-sm btn-secondary" [disabled]="currentCandidatesPage === totalCandidatesPages" 
            (click)="goToCandidatesPage(currentCandidatesPage + 1)">Next</button>
  </div>

  <hr>

  <!-- LISTA DE VOTOS -->
  <h4>Votes entered</h4>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>ID vote</th>
        <th>Voter</th>
        <th>Candidate</th>
        <th>Date</th>
        <th *ngIf="isAdmin">Detail</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of pagedVotes">
        <td>{{ item.vote_id }}</td>
        <td>{{ item.voter_name }} {{ item.voter_lastName }}</td>
        <td>{{ item.candidate_name }} {{ item.candidate_lastName }}</td>
        <td>{{ item.vote_date | date:'short' }}</td>
        <td *ngIf="isAdmin">
          <button class="btn btn-primary btn-sm" (click)="viewDetail(item.vote_id)">View</button>
        </td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="totalVotesPages > 1" class="mb-3">
    <button class="btn btn-sm btn-secondary" [disabled]="currentVotesPage === 1" 
            (click)="goToVotesPage(currentVotesPage - 1)">Previous</button>
    <span>Page {{currentVotesPage}} of {{totalVotesPages}}</span>
    <button class="btn btn-sm btn-secondary" [disabled]="currentVotesPage === totalVotesPages" 
            (click)="goToVotesPage(currentVotesPage + 1)">Next</button>
  </div>

  <!-- DETALLE DEL VOTO SOLO ADMIN -->
  <div *ngIf="isAdmin && selectedVote" class="card p-3 mt-3">
    <h5>Vote detail</h5>
    <p><strong>ID vote:</strong> {{ selectedVote.vote_id }}</p>
    <p><strong>Voter:</strong> {{ selectedVote.voter_name }} {{ selectedVote.voter_lastName }}</p>
    <p><strong>Document:</strong> {{ selectedVote.voter_document }}</p>
    <p><strong>Date of birth:</strong> {{ selectedVote.voter_dob }}</p>
    <p><strong>Candidate:</strong> {{ selectedVote.candidate_name }} {{ selectedVote.candidate_lastName }}</p>
    <p><strong>Vote date:</strong> {{ selectedVote.vote_date | date:'short' }}</p>
  </div>

</div>
